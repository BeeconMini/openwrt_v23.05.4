--- a/fs/smb/server/oplock.c
+++ b/fs/smb/server/oplock.c
@@ -1190,6 +1190,12 @@ int smb_grant_oplock(struct ksmbd_work *
 	struct ksmbd_inode *ci = fp->f_ci;
 	bool prev_op_has_lease;
 	__le32 prev_op_state = 0;
+	
+	/* Only v2 leases handle the directory */
+	if (S_ISDIR(file_inode(fp->filp)->i_mode)) {
+		if (!lctx || lctx->version != 2)
+			return 0;
+	}
 
 	opinfo = alloc_opinfo(work, pid, tid);
 	if (!opinfo)
